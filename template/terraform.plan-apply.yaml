parameters:
  - name: environmentServiceNameAzureRM
    type: string
  - name: backendAzureRmResourceGroupName
    type: string
  - name: environments
    type: object
    default:
      - name: hpdev
        dependsOnEnv: ""
      - name: hpprod
        dependsOnEnv: "hpdev"

steps:
  - task: TerraformTaskV4@4
    displayName: terraform plan for ${{ environments.name }}
    inputs:
      provider: 'azurerm'
      command: 'plan'
      environmentServiceNameAzureRM: ${{ parameters.environmentServiceNameAzureRM }}
      backendAzureRmResourceGroupName: ${{ parameters.backendAzureRmResourceGroupName }}

  - task: TerraformTaskV4@4
    displayName: terraform apply for ${{ environments.name }}
    inputs:
      provider: 'azurerm'
      command: 'apply'
      environmentServiceNameAzureRM: ${{ parameters.environmentServiceNameAzureRM }}
      backendAzureRmResourceGroupName: ${{ parameters.backendAzureRmResourceGroupName }}
