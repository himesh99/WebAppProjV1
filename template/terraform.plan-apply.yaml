parameters:
  - name: environmentServiceNameAzureRM
    type: string
  - name: backendAzureRmResourceGroupName
    type: string
  - name: tfversion
    type: string
  - name: backendServiceArm
    type: string
  - name: backendAzureRmStorageAccountName
    type: string
  - name: backendAzureRmContainerName
    type: string
  - name: workingDirectory
    type: string
  - name: backendAzureRmKey
    type: string
  - name: environments
    type: object
    default:
      - name: Development
        dependsOnEnv: ""
      - name: Production
        dependsOnEnv: "Development"

steps:
  - task: TerraformTaskV4@4
    displayName: terraform init
    inputs:
      provider: 'azurerm'
      command: 'init'
      tfVersion: ${{ parameters.tfversion }}
      backendServiceArm: ${{ parameters.backendServiceArm }}
      backendAzureRmResourceGroupName: ${{ parameters.backendAzureRmResourceGroupName }}
      backendAzureRmStorageAccountName: ${{ parameters.backendAzureRmStorageAccountName }}
      backendAzureRmContainerName: ${{ parameters.backendAzureRmContainerName }} 
      backendAzureRmKey: ${{ parameters.backendAzureRmKey }}
      workingDirectory: ${{ parameters.workingDirectory }}

  - task: TerraformTaskV4@4
    displayName: terraform apply for 
    inputs:
      provider: 'azurerm'
      command: 'apply'
      environmentServiceNameAzureRM: ${{ parameters.environmentServiceNameAzureRM }}
      backendAzureRmResourceGroupName: ${{ parameters.backendAzureRmResourceGroupName }}
      workingDirectory: ${{ parameters.workingDirectory }}
